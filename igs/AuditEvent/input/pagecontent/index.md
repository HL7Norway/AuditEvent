### Introduction
This implementationguide is based on the list of attributes defined by [Tillitsrammeverk](https://github.com/NorskHelsenett/Tillitsrammeverk/blob/main/specs/informasjons_og_datamodell.md#42-datamodell) used in data sharing scenarios between consumer and provider organizations. 

The guide does also aim to comply with the the minimum and recommended set of information that should be logged according to [Norwegian Code of Conduct ("Normen")](https://www.ehelse.no/normen/documents-in-english) 6.1 chapter 5.4.4 and therefore is also applicable to use cases within one organization, i.e. data sharing scenarios between systems or in one single system for that matter.

### Background
In a scenario where a healthcare organization (such as a hospital, GPs, etc.) needs to access patient health data from another healthcare organization or national service, both the consumer and service provider organizations are legally required to maintain proper audit logs for future analysis. 

These audit logs necessitate some contextual information that describes the patient contact at the consumer health care organization including details about the practitioner (agent), patient identification, organizational affiliation, and a component known as the *care relationship* that explains why the practitioner accessed the patient’s data (e.g. Hospital contact, GP consultancy, etc.). Except the latter, contextual information is located in AuditEvent referenced components as [PractitionerRole](https://hl7.org/fhir/R4/practitionerrole.html), [Practitioner](https://hl7.org/fhir/R4/practitioner.html), [Patient](https://www.hl7.org/fhir/R4/patient.html), [Encounter](https://www.hl7.org/fhir/R4/encounter.html), [Organization](https://hl7.org/fhir/R4/organization.html) and [Location](https://hl7.org/fhir/R4/location.html).

Only a small portion of the contextual information is transferred to the service provider in the form of attributes in a security token described in [Nasjonalt tillitsrammeverk](https://github.com/NorskHelsenett/Tillitsrammeverk/blob/main/specs/informasjons_og_datamodell.md#42-datamodell), typically JWT or SAML. That means the referenced resources metioned above need to be constructed based solely on the contents of a security token at the service provide side, and hence will be partially populated compared to the consumer provider side. In such scenarios the referenced resources will typically appear as contained resources within an AuditEvent Resource. 

### Mapping

The table is an overview of mappings to different re to AuditEvent fields are described in the "Description & Constraint" column. 

From versjon -6:

| Category         | Attribute                | Description                                                                           | Resource                                                                | Profile                                                                                                        |
|:-----------------|:-------------------------|:------------------------------------------------------------------------------------------------------|:------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------|
|                   |toa                    | Time (unix time/epoch time) when the attestation was performed.                                              | [AuditEvent](https://hl7.org/fhir/R4/auditevent)                        | [no-domain-Trustframework-Auditevent](StructureDefinition-no-domain-Trustframework-Auditevent.html)| 
| practitioner     | identifier             | Health personnel’s social security number and name from the Norwegian National Registry.                                           | [Practitioner](https://hl7.org/fhir/R4/practitioner.html)               | [no-doc-Trustframework-Practitioner](StructureDefinition-no-doc-Trustframework-Practitioner.html)                          |
| practitioner     | hpr-nr                 | Health personnel’s HPR number, if it exists.                                                       | [Practitioner](https://hl7.org/fhir/R4/practitioner.html)               | [no-doc-Trustframework-Practitioner](StructureDefinition-no-doc-Trustframework-Practitioner.html)                          |
| practitioner     | authorization     	  | Health personnel's authorization, if it exists.                                                     | [Practitioner](https://hl7.org/fhir/R4/practitioner.html)               | [no-doc-Trustframework-Practitioner](StructureDefinition-no-doc-Trustframework-Practitioner.html)                           |
| practitioner     | legal-entity           | The main unit (the legally responsible entity) where the health personnel work, its organization number and name. | [Organization](https://hl7.org/fhir/R4/organization.html)               | [no-doc-Trustframework-Organization-PractitionerLegalentity](StructureDefinition-no-doc-Trustframework-Organization-PractitionerLegalentity.html)   |
| practitioner     | point-of-care          | The treatment location’s organization number and name. It can have the same value as in ‘legal-entity’                        | [Organization](https://hl7.org/fhir/R4/organization.html)               | [no-doc-Trustframework-Organization-PractitionerPointofcare](StructureDefinition-no-doc-Trustframework-Organization-PractitionerPointofcare.html)          |
| practitioner     | department             | Department/organizational unit where the health personnel provide health care.                                              | [Organization](https://hl7.org/fhir/R4/organization.html)               | [no-doc-Trustframework-Organization-PractitionerDepartment](StructureDefinition-no-doc-Trustframework-Organization-PractitionerDepartment.html)       |
| care-relation    | healthcare-service     | Types of health services provided by the business.                                                       | [Encounter](https://hl7.org/fhir/R4/encounter.html)                     | [no-domain-Trustframework-Encounter](StructureDefinition-no-domain-Trustframework-Encounter.html)                                 |
| care-relation    | purpose-of-use         | The health personnel’s purpose for the health information (what it will be used for).                              | [AuditEvent](https://hl7.org/fhir/R4/auditevent.html)                   | [no-domain-Trustframework-Auditevent](StructureDefinition-no-domain-Trustframework-Auditevent.html)                                                                                                    |
| care-relation    | purpose-of-use-details | Detailed description of the health personnel’s purpose for the health information (what it will be used for).   | [AuditEvent](https://hl7.org/fhir/R4/auditevent.html)                   | [no-domain-Trustframework-Auditevent](StructureDefinition-no-domain-Trustframework-Auditevent.html)                                                                                                    |
| care-relation    | decision-ref           | Identification of access decision allowing participant to access patient information.                                                                | [AuditEvent](https://hl7.org/fhir/R4/auditevent.html)                   | [no-domain-Trustframework-Auditevent](StructureDefinition-no-domain-Trustframework-Auditevent.html)                                                                                                    |
| patient          | identifier             | Unique identification of patient                                                                      | [Patient](https://hl7.org/fhir/R4/patient.html)                         | [no-doc-Trustframework-Patient](StructureDefinition-no-doc-Trustframework-Patient.html)                                     |
| patient          | point-of-care  	      | The business where the patient receives treatment. It can have the same value as in ‘legal-entity’.             | [Organization](https://hl7.org/fhir/R4/organization.html)               | [no-doc-Trustframework-Organization-EncounterPointofcare](StructureDefinition-no-doc-Trustframework-Organization-EncounterPointofcare.html)                |
| patient          | department             | Department/organizational unit where the patient receives health care.                                        	          | [Organization](https://hl7.org/fhir/R4/organization.html)               | [no-doc-Trustframework-Organization-EncounterServiceprovider](StructureDefinition-no-doc-Trustframework-Organization-EncounterServiceprovider.html)|

![AuditEventNorwayUML](AuditEvent-ClassDiagram.svg)

### Next step
Click here to open main [no-domain-Trustframework-AuditEvent](StructureDefinition-no-domain-Trustframework-Auditevent.html) main profile for details or click [here](AuditEvent-ClassDiagram.svg) to navigate from diagram above.

## You can also download:

* [this entire guide](full-ig.zip),
* the definition resources in [json](definitions.json.zip), [xml](definitions.xml.zip), [ttl](definitions.ttl.zip), or [csv](csvs.zip) format, or
* the example resources in [json](examples.json.zip), [xml](examples.xml.zip) or [ttl](examples.ttl.zip) format.

The source code for this Implementation Guide can be found on [GitHub](https://github.com/HL7Norway/AuditEvent)